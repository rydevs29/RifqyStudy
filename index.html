<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RifqyStudy – Rekam & AI Soal</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png" type="image/png">
  <meta name="theme-color" content="#e74c3c">
  <style>
    :root {
      --primary: #e74c3c;
      --bg: #1a1a2e;
      --card: #16213e;
      --text: #e0e0e0;
      --border: rgba(231,76,60,0.3);
      --radius: 24px;
      --gap: 20px;
      --padding: 28px;
      --shadow: 0 12px 32px rgba(0,0,0,0.2);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: var(--bg); 
      color: var(--text); 
      min-height: 100vh; 
      padding: var(--gap); 
    }

    .container { max-width: 900px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 32px; }
    h1 { font-size: 36px; color: var(--primary); margin-bottom: 8px; font-weight: 700; }
    .subtitle { font-size: 18px; margin-bottom: 4px; }
    .limit { font-size: 16px; color: #e74c3c; }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: var(--padding);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      margin-bottom: var(--gap);
    }

    /* REKAM SUARA */
    .recorder {
      display: flex;
      gap: 14px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .btn-rec {
      background: var(--primary);
      color: white;
      padding: 16px 24px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 17px;
      min-width: 120px;
      text-align: center;
    }
    select {
      flex: 1;
      padding: 16px 20px;
      border-radius: 20px;
      background: #2d3436;
      color: white;
      border: none;
      font-size: 17px;
    }

    .pomodoro {
      text-align: center;
      padding: 20px;
      background: #2d3436;
      border-radius: 20px;
      font-size: 24px;
      font-weight: bold;
      margin: 20px 0;
    }

    /* TRANSCRIPT — BERSIH, TANPA DOUBLE */
    .transcript {
      background: #2d3436;
      padding: 20px;
      border-radius: 20px;
      min-height: 120px;
      font-size: 16px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
      border: 2px solid transparent;
      transition: border 0.3s;
    }
    .transcript.recording {
      border-color: var(--primary);
      animation: pulse 1.5s infinite;
    }

    /* TOMBOL AKSI */
    .actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 20px;
    }
    .btn-action {
      padding: 16px;
      border-radius: 20px;
      background: #2d3436;
      color: white;
      text-align: center;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
    }
    .btn-action:hover { background: #3a3f50; }

    /* MATERI TERSIMPAN */
    .saved-materials {
      grid-column: 1 / -1;
    }
    .saved-materials h3 {
      text-align: center;
      margin-bottom: 16px;
      font-size: 18px;
    }
    #saved-list {
      max-height: 300px;
      overflow-y: auto;
    }
    .material-item {
      padding: 16px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 15px;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(231,76,60,0.4); }
      70% { box-shadow: 0 0 0 10px rgba(231,76,60,0); }
      100% { box-shadow: 0 0 0 0 rgba(231,76,60,0); }
    }

    .hidden { display: none; }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
      <h1>RifqyStudy</h1>
      <p class="subtitle">Rekam Guru → AI Bikin Soal!</p>
      <p class="limit">Batas rekam: 10 menit (versi gratis)</p>
    </div>

    <!-- CARD UTAMA -->
    <div class="card">
      <!-- REKAM & MATA PELAJARAN -->
      <div class="recorder">
        <div class="btn-rec" id="recBtn">Rekam</div>
        <select id="subject">
          <option>IPA</option>
          <option>IPS</option>
          <option>Matematika</option>
          <option>Bahasa Indonesia</option>
          <option>Ppkn</option>
        </select>
      </div>

      <!-- POMODORO -->
      <div class="pomodoro" id="pomodoro">25:00</div>

      <!-- TRANSCRIPT — BERSIH -->
      <div class="transcript" id="transcript">
        Tekan "Rekam" untuk mulai merekam suara guru...
      </div>

      <!-- TOMBOL AKSI -->
      <div class="actions">
        <div class="btn-action" onclick="generateSummary()">Ringkas</div>
        <div class="btn-action" onclick="generateQuestion()">Buat Soal</div>
        <div class="btn-action" onclick="exportPDF()">PDF</div>
        <div class="btn-action" onclick="saveMaterial()">Simpan</div>
      </div>
    </div>

    <!-- MATERI TERSIMPAN -->
    <div class="card saved-materials">
      <h3>Materi Tersimpan</h3>
      <div id="saved-list">
        <div style="text-align:center; opacity:0.6; padding:20px 0;">Belum ada materi.</div>
      </div>
    </div>
  </div>

  <script>
    let mediaRecorder;
    let audioChunks = [];
    let transcript = '';
    let isRecording = false;
    let pomodoroInterval;
    let pomodoroTime = 25 * 60;
    let savedMaterials = JSON.parse(localStorage.getItem('rifqyStudy_materials') || '[]');

    const recBtn = document.getElementById('recBtn');
    const transcriptEl = document.getElementById('transcript');
    const pomodoroEl = document.getElementById('pomodoro');
    const savedList = document.getElementById('saved-list');

    // UPDATE SAVED LIST
    function updateSavedList() {
      if (savedMaterials.length === 0) {
        savedList.innerHTML = '<div style="text-align:center; opacity:0.6; padding:20px 0;">Belum ada materi.</div>';
      } else {
        savedList.innerHTML = savedMaterials.map((m, i) => `
          <div class="material-item">
            <strong>${m.subject}</strong> - ${new Date(m.date).toLocaleDateString('id-ID')}
            <br><small>${m.transcript.substring(0, 80)}...</small>
          </div>
        `).join('');
      }
    }

    // REKAM SUARA
    recBtn.addEventListener('click', async () => {
      if (!isRecording) {
        // MULAI REKAM
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
          // Simulasi transkripsi (ganti dengan API nanti)
          setTimeout(() => {
            transcript = 'Halo, hari ini kita belajar tentang fotosintesis. Daun menyerap cahaya matahari dan karbon dioksida untuk membuat glukosa dan oksigen.';
            transcriptEl.textContent = transcript;
          }, 1000);
        };

        mediaRecorder.start();
        isRecording = true;
        recBtn.textContent = 'Stop';
        recBtn.style.background = '#27ae60';
        transcriptEl.classList.add('recording');
        transcriptEl.textContent = 'Merekam... (bicara sekarang)';
        startPomodoro();
      } else {
        // STOP REKAM
        mediaRecorder.stop();
        isRecording = false;
        recBtn.textContent = 'Rekam';
        recBtn.style.background = 'var(--primary)';
        transcriptEl.classList.remove('recording');
        stopPomodoro();
      }
    });

    // POMODORO
    function startPomodoro() {
      pomodoroInterval = setInterval(() => {
        if (pomodoroTime > 0) {
          pomodoroTime--;
          const mins = Math.floor(pomodoroTime / 60).toString().padStart(2, '0');
          const secs = (pomodoroTime % 60).toString().padStart(2, '0');
          pomodoroEl.textContent = `${mins}:${secs}`;
        } else {
          stopPomodoro();
          alert('Waktu rekam selesai!');
        }
      }, 1000);
    }

    function stopPomodoro() {
      clearInterval(pomodoroInterval);
      pomodoroTime = 25 * 60;
      pomodoroEl.textContent = '25:00';
    }

    // AKSI
    function generateSummary() {
      if (!transcript) return alert('Rekam dulu!');
      alert('Ringkasan: [Fitur Premium]');
    }

    function generateQuestion() {
      if (!transcript) return alert('Rekam dulu!');
      alert('Soal: [Fitur Premium]');
    }

    function exportPDF() {
      if (!transcript) return alert('Rekam dulu!');
      alert('PDF: [Fitur Premium]');
    }

    function saveMaterial() {
      if (!transcript) return alert('Rekam dulu!');
      const material = {
        subject: document.getElementById('subject').value,
        transcript,
        date: new Date().toISOString()
      };
      savedMaterials.unshift(material);
      localStorage.setItem('rifqyStudy_materials', JSON.stringify(savedMaterials));
      updateSavedList();
      alert('Materi tersimpan!');
    }

    // INIT
    updateSavedList();
  </script>
</body>
  </html>
